(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const w="3bd73ecada1d478a8c9473ad4115be38";async function O(e,n){let r,t;try{if(r=await k(e),!r)throw new Error("Failed to geocode origin");if(t=await k(n),!t)throw new Error("Failed to geocode destination")}catch(s){return console.error("Geocoding error for distance calculation:",s),null}return await P(r,t)}async function P(e,n){if(!(e!=null&&e.lat)||!(n!=null&&n.lat))return console.warn("getDrivingDistanceByCoords: Invalid coordinates.",e,n),null;const r=`${e.lat},${e.lon}|${n.lat},${n.lon}`,t=`https://api.geoapify.com/v1/routing?waypoints=${encodeURIComponent(r)}&mode=drive&units=metric&apiKey=${w}`;try{const i=await(await fetch(t)).json();return i.features&&i.features.length>0?i.features[0].properties.distance/1e3:(console.error("Geoapify Routing API Error:",i),null)}catch(s){return console.error("Failed to fetch distance (Geoapify):",s),null}}function I(e){return typeof e!="string"?"":e.replace(/^\["|"\]$/g,"").trim()}function D(e){if(typeof e!="string"||!e.trim())return"-";let n="-";const r=e.trim();if(r.startsWith("[{")&&r.endsWith("}]"))try{const t=JSON.parse(r);if(Array.isArray(t)){const s=t.map(i=>i.address||"").filter(Boolean);s.length>0&&(n=s.join(" - "))}}catch{n=r.replace(/[\[\]\{\}"]/g,"").replace(/,/g," - ").trim()}else n=I(r);return n||"-"}function j(e){if(typeof e!="string"||!e.trim())return null;const n=e.trim();if(n.startsWith("[{")&&n.endsWith("}]"))try{const r=JSON.parse(n);if(Array.isArray(r)&&r.length>0)return r[r.length-1].address||null}catch{return I(n)}return I(n)}async function k(e){if(!e||typeof e!="string"||e.trim().length<3)return Promise.reject("Invalid address");const n=`https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(e)}&filter=countrycode:br&lang=pt&apiKey=${w}`;try{const t=await(await fetch(n)).json();if(t.features&&t.features.length>0){const s=t.features[0].geometry.coordinates;return{lat:s[1],lon:s[0]}}else{const s=`${e}, GuaÃ­ba, RS`,i=`https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(s)}&filter=countrycode:br&lang=pt&apiKey=${w}`,c=await(await fetch(i)).json();if(c.features&&c.features.length>0){const a=c.features[0].geometry.coordinates;return{lat:a[1],lon:a[0]}}else throw new Error("ZERO_RESULTS")}}catch(r){throw console.error(`Geocoding failed for: ${e}`,r),r}}let h=null,o={rides:[],drivers:[],users:[],appIcon:localStorage.getItem("appIcon")||null,currentDriverId:null,currentUserRideId:null,currentUserId:null,userStatusInterval:null,currentUserOrigin:null,currentUserDestination:null,isOriginSelected:!1,isDestinationSelected:!1,isNewUserAddressSelected:!1,isEditUserAddressSelected:!1};const H="https://jowsbmuqbzxukbbxbeqv.supabase.co",F="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impvd3NibXVxYnp4dWtiYnhiZXF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NzA5NjQsImV4cCI6MjA3MTA0Njk2NH0.UMW2aQmuq0RiEHgody5StKEQzDjrKZnfUprDgDaMd1w",u=supabase.createClient(H,F),m=document.getElementById("admin-ringtone");let E=null,S=!1;function x(){S||!m||(m.muted=!0,m.play().then(()=>{m.pause(),m.currentTime=0,m.muted=!1,S=!0,document.body.removeEventListener("click",x),document.body.removeEventListener("touchstart",x)}).catch(()=>{m.muted=!1}))}document.body.addEventListener("click",x);document.body.addEventListener("touchstart",x);function A(){S&&(m.currentTime=0,m.play().catch(e=>console.error("Error playing admin sound:",e)))}function G(){var e;T(),A(),E=setInterval(A,6e3),(e=document.getElementById("admin-silence-btn"))==null||e.classList.remove("hidden")}function T(){var e;E&&(clearInterval(E),E=null),m&&(m.pause(),m.currentTime=0),(e=document.getElementById("admin-silence-btn"))==null||e.classList.add("hidden")}function K(){var e;(e=document.getElementById("silence-btn"))==null||e.classList.add("hidden")}function l(e,n,r=!1,t={}){document.getElementById("modal-message").textContent=e;const s=document.getElementById("modal-confirm"),i=document.getElementById("modal-cancel"),d=document.getElementById("modal-input-container");Array.from(d.children).forEach(a=>{(a.tagName==="INPUT"||a.tagName==="SELECT"||a.classList.contains("autocomplete-container"))&&(a.style.display="none",a.tagName!=="DIV"&&(a.value=""))}),document.getElementById("modal-input-address").value="",t.type?(d.classList.remove("hidden"),t.type==="edit-driver"?(document.getElementById("modal-input-name").style.display="block",document.getElementById("modal-input-phone").style.display="block",document.getElementById("modal-input-plate").style.display="block",document.getElementById("modal-input-model").style.display="block",document.getElementById("modal-input-color").style.display="block",document.getElementById("modal-input-password").style.display="block",document.getElementById("modal-input-status").style.display="block",document.getElementById("modal-input-name").value=t.name,document.getElementById("modal-input-phone").value=t.phone,document.getElementById("modal-input-plate").value=t.plate,document.getElementById("modal-input-model").value=t.car_model||"",document.getElementById("modal-input-color").value=t.car_color||"",document.getElementById("modal-input-status").value=t.status):t.type==="edit-user"?(document.getElementById("modal-input-matricula").style.display="block",document.getElementById("modal-input-name").style.display="block",document.getElementById("modal-input-password").style.display="block",document.getElementById("modal-input-company").style.display="block",document.getElementById("modal-input-address").parentElement.style.display="block",document.getElementById("modal-input-phone").style.display="block",document.getElementById("modal-input-matricula").value=t.matricula,document.getElementById("modal-input-name").value=t.name,document.getElementById("modal-input-company").value=t.company,document.getElementById("modal-input-address").value=t.address,document.getElementById("modal-input-phone").value=t.phone):t.type==="driver-password"?document.getElementById("modal-input-driver-password").style.display="block":t.type==="delete-with-password"&&(document.getElementById("modal-input-admin-password").style.display="block")):d.classList.add("hidden"),s.onclick=n||B,i.style.display=r?"inline-block":"none",s.textContent=r?"Confirmar":"OK";const c=document.getElementById("modal");c.classList.remove("hidden"),c.classList.add("flex")}function B(){const e=document.getElementById("modal");e.classList.add("hidden"),e.classList.remove("flex")}function J(){o.currentUserId=null,o.currentDriverId=null,localStorage.removeItem("sessionType"),localStorage.removeItem("loggedInUserId"),localStorage.removeItem("loggedInDriverId"),g("initial-screen")}async function W(){const e=document.getElementById("admin-password").value,n=document.getElementById("admin-login-error");e==="789512"?(n.classList.add("hidden"),document.getElementById("admin-password").value="",localStorage.setItem("sessionType","admin"),g("admin-screen")):n.classList.remove("hidden")}async function Y(){const e=document.getElementById("user-id").value,n=document.getElementById("user-password").value,r=document.getElementById("user-login-error"),{data:t,error:s}=await u.from("users").select("*").eq("matricula",e).eq("password",n).single();if(s&&s.code!=="PGRST116"){r.textContent="Server communication error.",r.classList.remove("hidden");return}t?(o.currentUserId=t.id,localStorage.setItem("sessionType","user"),localStorage.setItem("loggedInUserId",t.id),r.classList.add("hidden"),g("user-screen")):(r.textContent="Incorrect ID or password!",r.classList.remove("hidden"))}function g(e){document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));const n=document.getElementById(e);n&&n.classList.add("active"),T(),h&&clearInterval(h);const r=document.getElementById("app-container");["admin-requests-screen","admin-driver-crud-screen","admin-user-crud-screen","admin-heatmap-screen","admin-records-screen"].includes(e)?r.classList.add("pt-8"):r.classList.remove("pt-8"),e==="admin-requests-screen"&&(_(),N(),V("digital-clock")),e==="admin-heatmap-screen"&&Re(),e==="user-screen"&&U(),e==="admin-records-screen"&&Ee()}function V(e){const n=document.getElementById(e);n&&(h&&clearInterval(h),h=setInterval(()=>{n.textContent=new Date().toLocaleTimeString("pt-BR")},1e3))}function X(){l("Do you want to export the daily report before leaving?",()=>{B(),g("admin-screen")},!0),document.getElementById("modal-cancel").onclick=()=>{B(),g("admin-screen")}}async function z(){const e=document.getElementById("origin").value,n=document.getElementById("destination").value;if(!o.isOriginSelected||!e){l("Please select a valid ORIGIN address from the list.");return}if(!o.isDestinationSelected||!n){l("Please select a valid DESTINATION address from the list.");return}const r=document.getElementById("schedule-toggle").checked,t=document.getElementById("schedule-datetime").value;let s=null;if(r){if(!t){l("Please select a date and time for scheduling.");return}if(s=new Date(t).toISOString(),new Date(s)<new Date){l("The scheduled date cannot be in the past.");return}}document.getElementById("user-request-form").classList.add("hidden"),document.getElementById("user-status").classList.remove("hidden"),document.getElementById("user-status-message").textContent="Requesting ride...";try{let i=null;try{const v=j(n);if(v){const R=await O(e,v);R!==null&&(i=parseFloat(R.toFixed(1)))}}catch(v){console.error("Error calculating distance on request:",v)}const d=o.currentUserOrigin.properties,c={lat:d.lat,lon:d.lon},a=o.users.find(v=>v.id===o.currentUserId);if(!a)throw new Error("Current user not found!");const y={destination:n,origin_address:e,status:"requested",userId:a.id,userName:a.name,userCompany:a.company,requestTime:new Date().toISOString(),userLocation:c,request_type:r?"scheduled":"immediate",scheduled_datetime:s,km:i},{data:p,error:f}=await u.from("rides").insert([y]).select().single();if(f)throw f;o.currentUserRideId=p.id,document.getElementById("user-status-message").textContent="Waiting for a driver to accept...",q(),o.isOriginSelected=!1,o.isDestinationSelected=!1}catch{l("Could not process your ride request."),document.getElementById("user-request-form").classList.remove("hidden"),document.getElementById("user-status").classList.add("hidden")}}function U(){if(o.currentUserRideId){const e=o.rides.find(n=>n.id===o.currentUserRideId);e?(document.getElementById("user-request-form").classList.add("hidden"),document.getElementById("user-status").classList.remove("hidden"),$(e),q()):(o.currentUserRideId=null,document.getElementById("user-request-form").classList.remove("hidden"),document.getElementById("user-status").classList.add("hidden"))}}function q(){o.userStatusInterval&&clearInterval(o.userStatusInterval),o.userStatusInterval=setInterval(async()=>{if(!o.currentUserRideId){o.userStatusInterval&&clearInterval(o.userStatusInterval);return}const{data:e,error:n}=await u.from("rides").select("*").eq("id",o.currentUserRideId).single();e?$(e):(o.userStatusInterval&&clearInterval(o.userStatusInterval),o.currentUserRideId=null,document.getElementById("user-request-form").classList.remove("hidden"),document.getElementById("user-status").classList.add("hidden"))},5e3)}function $(e){var i,d,c,a;const n=document.getElementById("user-status-message"),r=document.getElementById("cancel-ride-btn");let t="Waiting for a driver...";switch(["status-icon-searching","status-icon-en-route","status-icon-arrived-pickup","status-icon-in-progress"].forEach(y=>{var p;return(p=document.getElementById(y))==null?void 0:p.classList.add("hidden")}),["requested","assigned","accepted","arrived_pickup"].includes(e.status)?r.classList.remove("hidden"):r.classList.add("hidden"),e.status){case"assigned":t=`Driver ${e.driverName} has been assigned. Waiting for acceptance...`,(i=document.getElementById("status-icon-searching"))==null||i.classList.remove("hidden");break;case"accepted":t=`Driver ${e.driverName} is on the way!`,(d=document.getElementById("status-icon-en-route"))==null||d.classList.remove("hidden");break;case"arrived_pickup":t=`Your driver, ${e.driverName}, has arrived at the pickup location.`,(c=document.getElementById("status-icon-arrived-pickup"))==null||c.classList.remove("hidden");break;case"in_progress":t=`Trip to ${D(e.destination)} is in progress.`,(a=document.getElementById("status-icon-in-progress"))==null||a.classList.remove("hidden");break;case"completed":t="Trip completed! Thank you.",o.userStatusInterval&&clearInterval(o.userStatusInterval),o.currentUserRideId=null,setTimeout(()=>{document.getElementById("user-request-form").classList.remove("hidden"),document.getElementById("user-status").classList.add("hidden")},5e3);break;case"canceled":t="Your ride has been canceled.",o.userStatusInterval&&clearInterval(o.userStatusInterval),o.currentUserRideId=null,setTimeout(()=>{document.getElementById("user-request-form").classList.remove("hidden"),document.getElementById("user-status").classList.add("hidden")},3e3);break}n.textContent=t}async function Z(){if(o.currentUserRideId){const{error:e}=await u.from("rides").update({status:"canceled"}).eq("id",o.currentUserRideId);e&&l("Could not cancel the ride.")}}function _(){const e=document.getElementById("admin-requests-list");e.innerHTML="";const n=o.rides.filter(s=>["requested","approved","pending_approval","scheduled"].includes(s.status));n.sort((s,i)=>new Date(s.request_type==="scheduled"&&s.scheduled_datetime||s.requestTime).getTime()-new Date(i.request_type==="scheduled"&&i.scheduled_datetime||i.requestTime).getTime()),document.getElementById("status-agendada-count").textContent=o.rides.filter(s=>s.status==="scheduled").length.toString(),document.getElementById("status-solicitado-count").textContent=o.rides.filter(s=>["requested","approved","pending_approval"].includes(s.status)).length.toString(),document.getElementById("status-designado-count").textContent=o.rides.filter(s=>s.status==="assigned").length.toString(),document.getElementById("status-em-andamento-count").textContent=o.rides.filter(s=>["accepted","arrived_pickup","in_progress"].includes(s.status)).length.toString(),document.getElementById("status-concluidas-count").textContent=o.rides.filter(s=>s.status==="completed").length.toString();const r=o.drivers.filter(s=>s.status==="active").length,t=o.drivers.length;document.getElementById("total-drivers-count").textContent=t.toString(),document.getElementById("active-drivers-count").textContent=r.toString(),document.getElementById("inactive-drivers-count").textContent=(t-r).toString(),n.length===0?e.innerHTML='<p class="text-center text-gray-400">No new requests.</p>':n.forEach(s=>{const i=document.createElement("div");i.className="card-gradient p-4 rounded-lg shadow-md";let d=s.request_type==="scheduled"&&s.scheduled_datetime?`<span class="text-xs font-bold py-1 px-2 rounded-full bg-orange-500 text-white">SCHEDULED ${new Date(s.scheduled_datetime).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}</span>`:'<span class="text-xs font-bold py-1 px-2 rounded-full bg-blue-500 text-white">IMMEDIATE</span>',c="";if(s.status==="pending_approval")c='<div class="mt-4 text-center p-2 rounded-lg bg-yellow-700 text-white font-semibold">Awaiting Approval</div>';else{let y=o.drivers.filter(p=>p.status==="active").map(p=>`<option value="${p.id}">${p.name}</option>`).join("");c=`
                    <div class="mt-4 flex gap-2">
                        <select id="driver-select-${s.id}" class="w-full p-2 rounded-lg bg-gray-800 border border-gray-600 focus:outline-none text-white">
                            <option value="">Select a driver</option>
                            ${y}
                        </select>
                        <button onclick="assignDriver(${s.id})" class="py-2 px-4 font-semibold rounded-lg button-gradient whitespace-nowrap text-white">Assign</button>
                    </div>`}i.innerHTML=`
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-semibold text-lg">New Request</h4>
                    ${d}
                </div>
                <p><strong>Origin:</strong> ${I(s.origin_address)}</p>
                <p><strong>Destination:</strong> ${D(s.destination)}</p>
                <p><strong>Observation:</strong> <span class="text-yellow-300">${s.observation||"None"}</span></p>
                <p><strong>Distance:</strong> ${s.km?`${s.km} km`:"N/A"}</p>
                <p class="text-sm text-gray-400">From: ${s.userName} (${s.userCompany||"N/A"})</p>
                <p class="text-sm text-gray-300">Requested at: ${new Date(s.requestTime).toLocaleTimeString()}</p>
                ${c}
            `,e.appendChild(i)})}function N(){const e=document.getElementById("admin-ongoing-rides-table"),n=o.rides.filter(t=>!["requested","approved","pending_approval","rejected","completed","canceled"].includes(t.status));if(n.length===0){e.innerHTML='<p class="text-center text-gray-400">No ongoing rides.</p>';return}let r=`
        <table class="w-full text-sm text-left">
            <thead class="text-xs text-gray-300 uppercase bg-gray-900/30">
                <tr>
                    <th scope="col" class="px-4 py-3">UsuÃ¡rio</th>
                    <th scope="col" class="px-4 py-3">Origem</th>
                    <th scope="col" class="px-4 py-3">Destino</th>
                    <th scope="col" class="px-4 py-3">ObservaÃ§Ã£o</th>
                    <th scope="col" class="px-4 py-3">DistÃ¢ncia (km)</th>
                    <th scope="col" class="px-4 py-3">Motorista</th>
                    <th scope="col" class="px-4 py-3">Status</th>
                    <th scope="col" class="px-4 py-3">Tipo</th>
                    <th scope="col" class="px-4 py-3">Data/Hora</th>
                    <th scope="col" class="px-4 py-3">AÃ§Ãµes</th>
                </tr>
            </thead>
            <tbody>`;n.sort((t,s)=>{const i=t.request_type==="scheduled"&&t.scheduled_datetime?new Date(t.scheduled_datetime):new Date(t.requestTime),d=s.request_type==="scheduled"&&s.scheduled_datetime?new Date(s.scheduled_datetime):new Date(s.requestTime);return i.getTime()-d.getTime()}),n.forEach(t=>{const s=ge(t.status);let i=t.request_type==="scheduled"?'<span class="text-xs font-bold py-1 px-2 rounded-full bg-orange-500 text-white">SCHEDULED</span>':'<span class="text-xs font-bold py-1 px-2 rounded-full bg-blue-500 text-white">IMMEDIATE</span>';const d=t.request_type==="scheduled"&&t.scheduled_datetime?new Date(t.scheduled_datetime).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):new Date(t.requestTime).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});let c=t.driverName||"N/A",a='<div class="flex items-center gap-2">';if(t.status!=="in_progress"&&t.status!=="arrived_pickup"){let p=o.drivers.filter(f=>f.status==="active").map(f=>`<option value="${f.id}" ${t.driverId==f.id?"selected":""}>${f.name}</option>`).join("");c=`
                <select id="ongoing-driver-select-${t.id}" class="w-full p-2 rounded-lg bg-gray-800 border border-gray-600 text-xs text-white">
                    <option value="">Select...</option>
                    ${p}
                </select>`,a+=`<button onclick="updateRideDriver(${t.id})" class="py-1 px-2 text-xs font-semibold rounded-lg button-gradient text-white">Save</button>`}a+=`
            <button onclick="adminCompleteRide(${t.id})" title="Mark as Completed" class="p-1 rounded-lg bg-green-600"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg></button>
            <button onclick="adminDeleteRide(${t.id})" title="Delete Ride" class="p-1 rounded-lg bg-red-600"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
        </div>`,r+=`
            <tr class="border-b border-gray-700">
                <td class="px-4 py-3">${t.userName}</td>
                <td class="px-4 py-3">${I(t.origin_address)}</td>
                <td class="px-4 py-3">${D(t.destination)}</td>
                <td class="px-4 py-3 text-yellow-300">${t.observation||"-"}</td>
                <td class="px-4 py-3">${t.km||"N/D"}</td>
                <td class="px-4 py-3">${c}</td>
                <td class="px-4 py-3"><span class="status-badge ${s.colorClass}">${s.text}</span></td>
                <td class="px-4 py-3">${i}</td>
                <td class="px-4 py-3">${d}</td>
                <td class="px-4 py-3">${a}</td>
            </tr>`}),r+="</tbody></table>",e.innerHTML=r}async function Q(e){const r=document.getElementById(`ongoing-driver-select-${e}`).value;if(!r){l("Please select a driver to save.");return}const t=o.drivers.find(i=>i.id==r);if(!t){l("Selected driver not found.");return}const{error:s}=await u.from("rides").update({status:"assigned",driverId:parseInt(t.id),driverName:t.name}).eq("id",e);l(s?"Could not update the driver.":"Driver assigned successfully!")}async function ee(e){const n=document.getElementById(`driver-select-${e}`).value;if(!n){l("Please select a driver.");return}const r=o.drivers.find(t=>t.id==n);if(r){const{error:t}=await u.from("rides").update({status:"assigned",driverId:parseInt(r.id),driverName:r.name}).eq("id",e);t&&l("Could not assign the driver.")}}async function te(){}function se(e){}function ne(e){}async function re(){}function ie(e){}async function oe(e){}function ae(){}function de(){}function ce(){}function le(e){}async function b(){const{data:e,error:n}=await u.from("drivers").select("*");n?console.error("Error fetching drivers:",n):o.drivers=e;const{data:r,error:t}=await u.from("users").select("*");t?console.error("Error fetching users:",t):o.users=r;const{data:s,error:i}=await u.from("rides").select("*");i?console.error("Error fetching rides:",i):o.rides=s}function ue(){u.channel("public:drivers").on("postgres_changes",{event:"*",schema:"public",table:"drivers"},e=>{b().then(()=>{var n;(n=document.querySelector(".screen.active"))==null||n.id})}).subscribe(),u.channel("public:users").on("postgres_changes",{event:"*",schema:"public",table:"users"},e=>{b().then(()=>{var n;(n=document.querySelector(".screen.active"))==null||n.id})}).subscribe(),u.channel("public:rides").on("postgres_changes",{event:"*",schema:"public",table:"rides"},e=>{localStorage.getItem("sessionType")==="admin"&&e.eventType==="INSERT"&&(e.new.status==="requested"||e.new.status==="scheduled"||e.new.status==="approved")&&G(),b().then(()=>{var r;const n=(r=document.querySelector(".screen.active"))==null?void 0:r.id;n==="admin-requests-screen"?(_(),N()):n==="driver-screen"||n==="user-screen"&&U()})}).subscribe()}async function me(){}async function pe(e){}function ge(e){return{pending_approval:{text:"PEND. APPROVAL",colorClass:"status-pending_approval"},approved:{text:"APPROVED",colorClass:"status-approved"},rejected:{text:"REJECTED",colorClass:"status-rejected"},requested:{text:"REQUESTED",colorClass:"status-requested"},assigned:{text:"ASSIGNED",colorClass:"status-assigned"},accepted:{text:"ACCEPTED",colorClass:"status-accepted"},arrived_pickup:{text:"AT PICKUP",colorClass:"status-arrived_pickup"},in_progress:{text:"IN PROGRESS",colorClass:"status-in_progress"},completed:{text:"COMPLETED",colorClass:"status-completed"},canceled:{text:"CANCELED",colorClass:"status-canceled"}}[e]||{text:e.toUpperCase(),colorClass:""}}function fe(){}function ye(){}function ve(){}function he(){}function Ie(){}async function Ee(){}function be(){}function we(){}async function xe(e){}async function Be(e){l("Are you sure you want to delete this ride? This action is irreversible.",async()=>{const{error:n}=await u.from("rides").delete().eq("id",e);l(n?`Error deleting ride: ${n.message}`:"Ride deleted successfully!")},!0)}let C;function Se(e,n,r){clearTimeout(C);const t=e.target,s=t.value;r&&(o[r]=!1),C=window.setTimeout(()=>{De(s,n,t)},300)}async function De(e,n,r){if(e.length<3){M(n);return}const t=document.getElementById(n);t.innerHTML='<div class="loading">Searching...</div>',t.classList.add("show");try{const i=await(await fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(e)}&lang=pt&limit=5&apiKey=${w}`)).json();i.features&&i.features.length>0?Le(i.features,n,r):t.innerHTML='<div class="no-results">No results found</div>'}catch{t.innerHTML='<div class="no-results">Error searching addresses</div>'}}function Le(e,n,r){const t=document.getElementById(n);t.innerHTML="",e.forEach(s=>{const i=document.createElement("div");i.className="autocomplete-item",i.innerHTML=`<strong>${s.properties.formatted}</strong>`,i.onclick=()=>Te(s,n,r),t.appendChild(i)})}function Te(e,n,r){var s,i;r.value=e.properties.formatted;const t=(i=(s=r.getAttribute("oninput"))==null?void 0:s.match(/'(is\w+Selected)'/))==null?void 0:i[1];t&&(o[t]=!0),r.id==="origin"&&(o.currentUserOrigin=e),r.id==="destination"&&(o.currentUserDestination=e),M(n)}function M(e){const n=document.getElementById(e);n&&n.classList.remove("show")}document.addEventListener("click",e=>{e.target.closest(".autocomplete-container")||document.querySelectorAll(".autocomplete-list").forEach(n=>n.classList.remove("show"))});async function Re(){}async function ke(){await b(),ue();const e=localStorage.getItem("sessionType"),n=localStorage.getItem("loggedInUserId"),r=localStorage.getItem("loggedInDriverId");e==="admin"?g("admin-screen"):e==="user"&&n?(o.currentUserId=parseInt(n,10),g("user-screen")):e==="driver"&&r?(o.currentDriverId=parseInt(r,10),g("driver-screen")):g("initial-screen")}const Ae=setInterval(()=>{typeof supabase<"u"&&typeof L<"u"&&typeof Chart<"u"&&typeof XLSX<"u"&&(clearInterval(Ae),ke())},100);Object.assign(window,{showScreen:g,loginAdmin:W,loginUser:Y,logout:J,promptToGoBack:X,exportDailyReportNow:fe,openRecordsTab:Ie,addDriver:te,editDriver:se,promptDeleteDriver:ne,toggleDriverStatusAdmin:pe,addUser:re,editUser:ie,deleteUser:oe,downloadUserTemplate:de,importUsersFromExcel:ce,exportUsersToExcel:ae,uploadAppIcon:ye,requestRide:z,cancelRide:Z,exportUserRidesToExcel:ve,handleAddressInput:Se,selectDriver:le,toggleDriverStatus:me,stopBeeping:K,exportDriverRidesToExcel:he,filterRecords:be,clearRecordsFilter:we,closeModal:B,stopRingingAdmin:T,assignDriver:ee,updateRideDriver:Q,adminCompleteRide:xe,adminDeleteRide:Be});
